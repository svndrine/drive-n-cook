<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âchec de paiement - Driv'n Cook</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333333;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .email-container {
            background-color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        .header .subtitle {
            margin: 10px 0 0 0;
            font-size: 16px;
            opacity: 0.9;
        }

        .error-icon {
            font-size: 60px;
            margin: 20px 0;
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .content {
            padding: 30px;
        }

        .greeting {
            font-size: 16px;
            margin-bottom: 20px;
        }

        .error-message {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 1px solid #f5c6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .error-message h3 {
            color: #721c24;
            margin: 0 0 10px 0;
            font-size: 20px;
        }

        .error-message p {
            color: #721c24;
            margin: 0;
            font-size: 16px;
        }

        .transaction-details {
            background-color: #f8f9fa;
            border-left: 4px solid #e74c3c;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .detail-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
            color: #e74c3c;
        }

        .detail-label {
            color: #666;
        }

        .detail-value {
            font-weight: bold;
        }

        .error-details {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .error-details h4 {
            color: #856404;
            margin-top: 0;
        }

        .error-details .error-code {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #e74c3c;
            margin: 10px 0;
        }

        .retry-section {
            background-color: #e8f4f8;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .retry-section h4 {
            color: #0c5460;
            margin-top: 0;
        }

        .retry-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .retry-section li {
            margin: 8px 0;
            color: #0c5460;
        }

        .cta-section {
            text-align: center;
            margin: 30px 0;
        }

        .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.2s;
            margin: 5px;
        }

        .cta-button.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .cta-button:hover {
            transform: translateY(-2px);
        }

        .support-section {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .support-section h4 {
            color: #155724;
            margin-top: 0;
        }

        .footer {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 12px;
        }

        .footer a {
            color: #e74c3c;
            text-decoration: none;
        }

        .legal {
            margin-top: 15px;
            opacity: 0.8;
            font-size: 10px;
        }

        @media only screen and (max-width: 600px) {
            body {
                padding: 10px;
            }

            .content {
                padding: 20px;
            }

            .detail-row {
                flex-direction: column;
                gap: 5px;
            }

            .cta-button {
                padding: 12px 25px;
                font-size: 14px;
                display: block;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
<div class="email-container">
    {{-- En-t√™te d'erreur --}}
    <div class="header">
        <div class="error-icon">‚ùå</div>
        <h1>√âchec de paiement</h1>
        <div class="subtitle">Votre transaction n'a pas pu √™tre trait√©e</div>
    </div>

    {{-- Contenu principal --}}
    <div class="content">
        <div class="greeting">
            Bonjour {{ $user->firstname }} {{ $user->lastname }},
        </div>

        <p>Nous vous informons que votre tentative de paiement n'a pas pu √™tre trait√©e avec succ√®s.</p>

        <div class="error-message">
            <h3>‚ö†Ô∏è Paiement √©chou√©</h3>
            <p>Ne vous inqui√©tez pas, aucun montant n'a √©t√© d√©bit√© de votre compte.</p>
        </div>

        {{-- D√©tails de la transaction --}}
        <div class="transaction-details">
            <h3 style="margin-top: 0; color: #2c3e50;">üìã D√©tails de la transaction</h3>

            <div class="detail-row">
                <span class="detail-label">Num√©ro de transaction :</span>
                <span class="detail-value">#{{ $transaction->id }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Montant :</span>
                <span class="detail-value">{{ number_format($transaction->amount, 2, ',', ' ') }} ‚Ç¨</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Type de paiement :</span>
                <span class="detail-value">
                        @switch($transaction->transaction_type)
                            @case('entry_fee')
                                üí∞ Droit d'entr√©e franchise
                                @break
                            @case('monthly_royalty')
                                üìä Royalties mensuelles
                                @break
                            @case('stock_purchase')
                                üì¶ Achat de stocks
                                @break
                            @case('penalty')
                                ‚ö†Ô∏è P√©nalit√©
                                @break
                            @default
                                {{ $transaction->description }}
                        @endswitch
                    </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Date/Heure :</span>
                <span class="detail-value">{{ $transaction->created_at->format('d/m/Y √† H:i') }}</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Statut :</span>
                <span class="detail-value" style="color: #e74c3c;">‚ùå √âchec</span>
            </div>
        </div>

        {{-- D√©tails de l'erreur --}}
        <div class="error-details">
            <h4>üîç Raison de l'√©chec</h4>
            <div class="error-code">{{ $error_message }}</div>

            <p><strong>Causes possibles :</strong></p>
            <ul>
                <li>üí≥ Carte expir√©e ou invalide</li>
                <li>üí∞ Solde insuffisant</li>
                <li>üè¶ Refus de la banque</li>
                <li>üîí Probl√®me de s√©curit√© (3D Secure)</li>
                <li>üì± Interruption de la connexion</li>
            </ul>
        </div>

        {{-- Section retry --}}
        <div class="retry-section">
            <h4>üîÑ Que faire maintenant ?</h4>
            <ol>
                <li><strong>V√©rifiez vos informations bancaires</strong>
                    <ul>
                        <li>Num√©ro de carte correct</li>
                        <li>Date d'expiration valide</li>
                        <li>Code CVV exact</li>
                    </ul>
                </li>
                <li><strong>Contactez votre banque</strong> si n√©cessaire</li>
                <li><strong>Essayez avec une autre carte</strong> de paiement</li>
                <li><strong>Relancez le paiement</strong> depuis votre espace</li>
            </ol>
        </div>

        {{-- Boutons d'action --}}
        <div class="cta-section">
            <a href="{{ $retry_url }}" class="cta-button">
                üîÑ R√©essayer le paiement
            </a>
            <a href="{{ url('/franchisee/payments/methods') }}" class="cta-button secondary">
                üí≥ Changer de carte
            </a>
        </div>

        {{-- Urgence selon le type --}}
        @if($transaction->transaction_type === 'entry_fee')
        <div class="error-details">
            <h4>‚ö†Ô∏è Important - Droit d'entr√©e</h4>
            <p>Votre franchise ne pourra √™tre activ√©e qu'apr√®s r√©ception du paiement du droit d'entr√©e.</p>
            <p><strong>Actions bloqu√©es en attendant :</strong></p>
            <ul>
                <li>‚ùå Acc√®s aux formations</li>
                <li>‚ùå Livraison du food truck</li>
                <li>‚ùå Commandes de stocks</li>
                <li>‚ùå Support technique avanc√©</li>
            </ul>
            <p><em>Merci de r√©gler ce paiement rapidement pour d√©bloquer votre franchise.</em></p>
        </div>
        @elseif($transaction->transaction_type === 'monthly_royalty')
        <div class="error-details">
            <h4>üìÖ √âch√©ance royalties</h4>
            <p>Vos royalties mensuelles restent impay√©es. En cas de retard :</p>
            <ul>
                <li>‚ö†Ô∏è P√©nalit√©s de retard possibles</li>
                <li>üö´ Suspension temporaire possible</li>
                <li>üìû Contact de notre service recouvrement</li>
            </ul>
            <p><strong>√âch√©ance :</strong> {{ $transaction->due_date ? $transaction->due_date->format('d/m/Y') : '√Ä d√©finir' }}</p>
        </div>
        @elseif($transaction->transaction_type === 'stock_purchase')
        <div class="error-details">
            <h4>üì¶ Commande de stocks</h4>
            <p>Votre commande de stocks ne pourra √™tre trait√©e qu'apr√®s r√©ception du paiement.</p>
            @if($transaction->order_reference)
            <p><strong>R√©f√©rence commande :</strong> {{ $transaction->order_reference }}</p>
            @endif
            <ul>
                <li>‚è∏Ô∏è Pr√©paration en attente</li>
                <li>üìÖ D√©lai de livraison report√©</li>
                <li>‚ö†Ô∏è Stock r√©serv√© pendant 48h seulement</li>
            </ul>
        </div>
        @endif

        {{-- Conseils pratiques --}}
        <div class="retry-section">
            <h4>üí° Conseils pour √©viter les √©checs</h4>
            <ul>
                <li>üïê <strong>Timing :</strong> √âvitez les paiements tard le soir ou t√¥t le matin</li>
                <li>üåê <strong>Connexion :</strong> Utilisez une connexion internet stable</li>
                <li>üîí <strong>S√©curit√© :</strong> D√©sactivez temporairement VPN/proxy</li>
                <li>üì± <strong>Navigateur :</strong> Autorisez les pop-ups pour 3D Secure</li>
                <li>üí≥ <strong>Limite :</strong> V√©rifiez vos plafonds de paiement</li>
                <li>üè¶ <strong>Autorisation :</strong> Pr√©venez votre banque des gros montants</li>
            </ul>
        </div>

        {{-- M√©thodes alternatives --}}
        <div class="retry-section">
            <h4>üîÑ M√©thodes de paiement alternatives</h4>
            <p>Si le probl√®me persiste, vous pouvez :</p>
            <ul>
                <li>üí≥ <strong>Autre carte :</strong> Essayer avec une autre carte bancaire</li>
                <li>üè¶ <strong>Virement :</strong> Demander nos coordonn√©es pour virement SEPA</li>
                <li>‚úâÔ∏è <strong>Ch√®que :</strong> Possibilit√© de paiement par ch√®que (d√©lai plus long)</li>
                <li>üìû <strong>T√©l√©phone :</strong> Paiement par t√©l√©phone avec nos conseillers</li>
            </ul>
            <p><em>Contactez notre service commercial pour ces options alternatives.</em></p>
        </div>

        {{-- Support prioritaire --}}
        <div class="support-section">
            <h4>üÜò Support prioritaire</h4>
            <p>Notre √©quipe est l√† pour vous aider √† r√©soudre ce probl√®me rapidement :</p>
            <ul>
                <li>üìû <strong>Hotline paiements :</strong> 01 23 45 67 89 (7j/7, 8h-20h)</li>
                <li>üìß <strong>Email prioritaire :</strong> <a href="mailto:paiements@drivncook.fr" style="color: #155724;">paiements@drivncook.fr</a></li>
                <li>üí¨ <strong>Chat urgent :</strong> Disponible dans votre espace franchis√©</li>
                <li>üì± <strong>WhatsApp :</strong> +33 1 23 45 67 89</li>
            </ul>

            <p><strong>üéØ Informations √† pr√©parer pour nous aider :</strong></p>
            <ul>
                <li>Num√©ro de transaction : <strong>#{{ $transaction->id }}</strong></li>
                <li>Message d'erreur exact</li>
                <li>Type de carte utilis√©e</li>
                <li>Heure pr√©cise de la tentative</li>
            </ul>
        </div>

        {{-- Rappel important --}}
        <div style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 20px; margin: 20px 0; text-align: center;">
            <h4 style="color: #856404; margin-top: 0;">‚ö†Ô∏è Rappel Important</h4>
            <p style="color: #856404; margin: 0;">
                <strong>Aucun montant n'a √©t√© d√©bit√©</strong> de votre compte suite √† cet √©chec.<br>
                Votre carte et vos donn√©es sont en s√©curit√©.
            </p>
        </div>

        {{-- D√©lais selon le type --}}
        @if($transaction->transaction_type !== 'penalty')
        <div class="error-details">
            <h4>‚è∞ D√©lais √† respecter</h4>
            @if($transaction->transaction_type === 'entry_fee')
            <p>Pour d√©bloquer votre franchise rapidement, nous recommandons de r√©gler ce paiement dans les <strong>24 heures</strong>.</p>
            @elseif($transaction->transaction_type === 'monthly_royalty')
            <p>Pour √©viter les p√©nalit√©s, merci de r√©gulariser dans les <strong>7 jours</strong>.</p>
            @elseif($transaction->transaction_type === 'stock_purchase')
            <p>Votre stock reste r√©serv√© pendant <strong>48 heures</strong>. Au-del√†, la commande sera annul√©e.</p>
            @endif
        </div>
        @endif

        <p style="margin-top: 30px; text-align: center;">
            <strong>Notre √©quipe reste √† votre disposition pour vous accompagner ! ü§ù</strong>
        </p>
    </div>

    {{-- Pied de page --}}
    <div class="footer">
        <div>
            <strong>Driv'n Cook</strong><br>
            123 Avenue de la R√©publique, 75012 Paris<br>
            üìû 01 23 45 67 89 | üìß contact@drivncook.fr
        </div>

        <div style="margin: 15px 0;">
            <a href="#">Centre d'aide</a> |
            <a href="#">FAQ Paiements</a> |
            <a href="#">Nous contacter</a>
        </div>

        <div class="legal">
            Cet email a √©t√© envoy√© √† {{ $user->email }}.<br>
            En cas de probl√®me persistant, n'h√©sitez pas √† nous contacter.<br><br>

            ¬© {{ date('Y') }} Driv'n Cook. Tous droits r√©serv√©s.<br>
            SIRET : 12345678901234 | TVA : FR12345678901
        </div>
    </div>
</div>
</body>
</html>
